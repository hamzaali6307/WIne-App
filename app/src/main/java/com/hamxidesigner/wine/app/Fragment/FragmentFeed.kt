package com.hamxidesigner.wine.app.Fragmentimport android.content.ContentValues.TAGimport android.content.Intentimport android.os.Bundleimport android.util.Logimport android.view.LayoutInflaterimport android.view.Viewimport android.view.ViewGroupimport android.view.animation.AnimationUtilsimport android.widget.*import androidx.core.content.ContextCompatimport com.hamxidesigner.wine.app.Rimport androidx.fragment.app.Fragmentimport androidx.recyclerview.widget.DefaultItemAnimatorimport androidx.recyclerview.widget.RecyclerViewimport androidx.recyclerview.widget.StaggeredGridLayoutManagerimport com.google.android.material.snackbar.Snackbarimport com.google.firebase.firestore.FirebaseFirestoreimport com.google.firebase.firestore.Queryimport com.hamxidesigner.wine.app.Activities.DetailsActivityimport com.hamxidesigner.wine.app.Activities.SearchingActivityimport com.hamxidesigner.wine.app.Adapter.DataAdapterimport com.hamxidesigner.wine.app.Helper.RecyclerViewTouchListenerimport com.hamxidesigner.wine.app.Helper.RecyclerViewTouchListener.ClickListenerimport com.hamxidesigner.wine.app.Model.DataModelimport com.kaopiz.kprogresshud.KProgressHUDimport java.util.*import kotlin.collections.ArrayListimport kotlin.math.logimport com.google.firebase.firestore.CollectionReference as CollectionReference1import java.lang.Exception as Exception1class FragmentFeed : Fragment() {    private lateinit var dataAdapter: DataAdapter    private lateinit var recyclerView: RecyclerView    private lateinit var arrayList: ArrayList<DataModel>    private lateinit var filter: ArrayList<DataModel>    private lateinit var mView: View    lateinit var dataModel: DataModel    lateinit var linear:LinearLayout    var ratings: Float = 0.0f    lateinit var relitive:RelativeLayout    lateinit var  txt_top:TextView    lateinit var  txt_botm:TextView    var ratinggg: Float = 0.0f    var id_type_en:String = ""    var id_type_es:String = ""    lateinit var wideIdAray: ArrayList<String>    lateinit var kProgressHUD: KProgressHUD    lateinit var db: FirebaseFirestore    var docRefCollecMain: CollectionReference1 = FirebaseFirestore.getInstance().collection("wines")    var docRefColWinTyp: CollectionReference1 = FirebaseFirestore.getInstance().collection("wine_type")    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {        mView = inflater.inflate(R.layout.fragment_main, container, false)        recyclerView = mView.findViewById(R.id.recyclerview)        linear = mView.findViewById(R.id.linear)        txt_top = mView.findViewById(R.id.txt_top)        txt_botm = mView.findViewById(R.id.txt_botm)        relitive = mView.findViewById(R.id.relitive)        arrayList = ArrayList<DataModel>()        wideIdAray = ArrayList<String>()        filter = ArrayList<DataModel>()        dataModel = DataModel()        initViews()        initObect()        clickView()        return mView    }    private fun initViews() {        initProgressDialog()        txt_top.setText("Choose Latest")        txt_botm.setText("Wine of your choice")    }    private fun clickView() {        recyclerView.addOnItemTouchListener(RecyclerViewTouchListener(context, recyclerView, object : ClickListener {            override fun onClick(view: View?, position: Int) {                val movie: DataModel = arrayList.get(position)                var intent = Intent(context, DetailsActivity::class.java)                dataModel = arrayList.get(position)                intent.putExtra("data", dataModel)                startActivity(intent)//                Toast.makeText(context, movie.wine_name + " is selected!", Toast.LENGTH_SHORT).show()            }            override fun onLongClick(view: View?, position: Int) {}        }))    }    private fun initObect() {        db = FirebaseFirestore.getInstance()        kProgressHUD.show()        dataAdapter = context?.let { DataAdapter(arrayList, it, arrayList) }!!        val mLayoutManager: RecyclerView.LayoutManager = StaggeredGridLayoutManager(2, StaggeredGridLayoutManager.VERTICAL)        recyclerView.setLayoutManager(mLayoutManager)        recyclerView.setItemAnimator(DefaultItemAnimator())        recyclerView.setAdapter(dataAdapter)        linear.visibility = View.VISIBLE        prepareData()    }    private fun prepareData() {        docRefCollecMain.get().addOnSuccessListener { documentSnapshot ->            if (!documentSnapshot.isEmpty) {                var test = documentSnapshot.documents                Log.d("wineess", test.size.toString())                for (documntName in test.indices) {                    var country_origin = test[documntName].get("country_origin") as String                    var ean = test[documntName].get("ean") as String                    var pdo_id = test[documntName].get("pdo_id") as String                    var pic = test[documntName].get("pic") as String                    var price_id = test[documntName].get("price_id") as String                    var wine_id = test[documntName].get("wine_id") as String                    var wine_name = test[documntName].get("wine_name") as String                    var wine_type = test[documntName].get("wine_type") as String                    var year = test[documntName].get("year") as String                    dataModel = DataModel(                            test.toString(),                            country_origin,                            ean,                            pdo_id,                            pic,                            price_id,                            wine_id,                            wine_name,                            wine_type,                            year,                            "",                            "",                            "")                    arrayList.add(dataModel)                    kProgressHUD.dismiss()                    dataAdapter.notifyDataSetChanged()                }            } else {                kProgressHUD.dismiss()                var snackbar = Snackbar                        .make(relitive,"No Wine found"  , Snackbar.LENGTH_LONG)                snackbar.show()            }        }    }    fun newInstance(): FragmentFeed {        return FragmentFeed()    }    private fun initProgressDialog() {        kProgressHUD = KProgressHUD.create(activity)                .setStyle(KProgressHUD.Style.SPIN_INDETERMINATE)                .setLabel("Please wait")                .setDetailsLabel("Fetching data")                .setCancellable(false)                .setAnimationSpeed(4)                .setBackgroundColor(resources.getColor(R.color.colorPrimaryDark))                .setDimAmount(0.5f)    }    override fun onDestroy() {        super.onDestroy()        kProgressHUD.dismiss()    }    override fun onResume() {        super.onResume()        prepareData()    }}